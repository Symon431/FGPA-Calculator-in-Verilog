module tb_calculator_datapath;

    reg clk, reset;
    reg [3:0] data_in;
    reg [2:0] op_code;
    reg [1:0] compute_op;
    wire [7:0] result;
    wire done, negative, div_by_zero;

    // Instantiate the calculator datapath
    calculator_datapath DUT (
        .clk(clk),
        .reset(reset),
        .data_in(data_in),
        .op_code(op_code),
        .compute_op(compute_op),
        .result(result),
        .done(done),
        .negative(negative),
        .div_by_zero(div_by_zero)
    );

    // Clock generation
    initial clk = 0;
    always #5 clk = ~clk;

    initial begin
        $display("Time\tOP\tData\tComputeOp\tResult\tDone\tNeg\tDiv0");

        // Reset system
        reset = 1; #10; reset = 0;

        // Load A = 7
        op_code = 3'b001;
        data_in = 4'd7;
        #10;

        // Load B = 3
        op_code = 3'b011;
        data_in = 4'd3;
        #10;

        // ADD: 7 + 3 = 10
        op_code = 3'b101;
        compute_op = 2'b00;
        #10;
        $display("%0t\tADD\t7\t00\t%b\t%b\t%b\t%b", $time, result, done, negative, div_by_zero);

        // SUB: 7 - 3 = 4
        compute_op = 2'b01;
        #10;
        $display("%0t\tSUB\t7\t01\t%b\t%b\t%b\t%b", $time, result, done, negative, div_by_zero);

        // Load A = 3
        op_code = 3'b001;
        data_in = 4'd3; #10;

        // Load B = 7
        op_code = 3'b011;
        data_in = 4'd7; #10;

        // SUB: 3 - 7 = -4
        op_code = 3'b101;
        compute_op = 2'b01; #10;
        $display("%0t\tSUB2\t3-7\t01\t%b\t%b\t%b\t%b", $time, result, done, negative, div_by_zero);

        // MUL: 3 * 7 = 21
        compute_op = 2'b10; #10;
        $display("%0t\tMUL\t3\t10\t%b\t%b\t%b\t%b", $time, result, done, negative, div_by_zero);

        // DIV: 3 / 7 = 0 rem 3 ? result = 00000011 00000000
        compute_op = 2'b11; #10;
        $display("%0t\tDIV\t3\t11\t%b\t%b\t%b\t%b", $time, result, done, negative, div_by_zero);

        // DIV by 0 test: B = 0
        op_code = 3'b011;
        data_in = 4'd0; #10;

        op_code = 3'b101;
        compute_op = 2'b11; #10;
        $display("%0t\tDIV0\tB=0\t11\t%b\t%b\t%b\t%b", $time, result, done, negative, div_by_zero);

        $finish;
    end
endmodule

