module tb_datapath;

    reg clk, reset;
    reg [3:0] data_in;
    reg [2:0] op_code;
    reg [1:0] compute_op;
    wire [7:0] result;
    wire done, negative, div_by_zero;

    datapath DUT (
        .clk(clk),
        .reset(reset),
        .data_in(data_in),
        .op_code(op_code),
        .compute_op(compute_op),
        .result(result),
        .done(done),
        .negative(negative),
        .div_by_zero(div_by_zero)
    );

    // Clock generation
    initial clk = 0;
    always #5 clk = ~clk;

    initial begin
        $display("Time\tOP\tData\tComputeOp\tResult\tDone\tNeg\tDiv0");

        // Reset system
        reset = 1; #10; reset = 0;

        // Load A = 7 (op_code = 001)
        op_code = 3'b001;
        data_in = 4'd7;
        #10;

        // Load B = 3 (op_code = 011)
        op_code = 3'b011;
        data_in = 4'd3;
        #10;

        // Display A
        op_code = 3'b010;
        #10;
        $display("%0t\tDISP_A\t-\t-\t%b\t%b\t%b\t%b", $time, result, done, negative, div_by_zero);

        // Display B
        op_code = 3'b100;
        #10;
        $display("%0t\tDISP_B\t-\t-\t%b\t%b\t%b\t%b", $time, result, done, negative, div_by_zero);

        // Compute ADD (7 + 3 = 10)
        op_code = 3'b101;
        compute_op = 2'b00;
        #10;
        $display("%0t\tADD\t-\t%02b\t%b\t%b\t%b\t%b", $time, compute_op, result, done, negative, div_by_zero);

        // Compute SUB (7 - 3 = 4)
        compute_op = 2'b01;
        #10;
        $display("%0t\tSUB\t-\t%02b\t%b\t%b\t%b\t%b", $time, compute_op, result, done, negative, div_by_zero);

        // Load A = 3
        op_code = 3'b001;
        data_in = 4'd3;
        #10;

        // Load B = 7
        op_code = 3'b011;
        data_in = 4'd7;
        #10;

        // Compute SUB (3 - 7 = -4, expect negative flag = 1)
        op_code = 3'b101;
        compute_op = 2'b01;
        #10;
        $display("%0t\tSUB_NEG\t-\t%02b\t%b\t%b\t%b\t%b", $time, compute_op, result, done, negative, div_by_zero);

        // Compute MUL (3 * 7 = 21)
        compute_op = 2'b10;
        #10;
        $display("%0t\tMUL\t-\t%02b\t%b\t%b\t%b\t%b", $time, compute_op, result, done, negative, div_by_zero);

        // Compute DIV (3 / 7, remainder 3, quotient 0)
        compute_op = 2'b11;
        #10;
        $display("%0t\tDIV\t-\t%02b\t%b\t%b\t%b\t%b", $time, compute_op, result, done, negative, div_by_zero);

        // Test division by zero
        op_code = 3'b011;
        data_in = 4'd0;
        #10;

        op_code = 3'b101;
        compute_op = 2'b11;
        #10;
        $display("%0t\tDIV0\t-\t%02b\t%b\t%b\t%b\t%b", $time, compute_op, result, done, negative, div_by_zero);

        // Display final result
        op_code = 3'b110;
        #10;
        $display("%0t\tDISP_RES\t-\t-\t%b\t%b\t%b\t%b", $time, result, done, negative, div_by_zero);

        $finish;
    end
endmodule
