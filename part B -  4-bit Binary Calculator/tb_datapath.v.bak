module tb_datapath;

    reg clk, reset;
    reg [3:0] data_in;
    reg [2:0] op_code;
    reg [1:0] reg_sel;
    reg [1:0] compute_op;
    wire [7:0] result;
    wire done, negative, div_by_zero;

    datapath DUT (
        .clk(clk),
        .reset(reset),
        .data_in(data_in),
        .op_code(op_code),
        .reg_sel(reg_sel),
        .compute_op(compute_op),
        .result(result),
        .done(done),
        .negative(negative),
        .div_by_zero(div_by_zero)
    );

    // Clock generation
    initial clk = 0;
    always #5 clk = ~clk;

    initial begin
        $display("Time\tOP\tData\tReg\tCompOp\tResult\tDone\tNeg\tDiv0");

        // Reset system
        reset = 1; #10; reset = 0;

        // Load A = 7
        op_code = 3'b100;  // LOAD
        reg_sel = 2'b00;   // Select RegA
        data_in = 4'd7;
        #10;

        // Load B = 3
        reg_sel = 2'b01;   // Select RegB
        data_in = 4'd3;
        #10;

        // Compute ADD (7 + 3 = 10)
        op_code = 3'b101;  // COMPUTE
        compute_op = 2'b00;
        #10;
        $display("%0t\tADD\t%d\t%d\t%02b\t%b\t%b\t%b\t%b", $time, data_in, reg_sel, compute_op, result, done, negative, div_by_zero);

        // Compute SUB (7 - 3 = 4)
        compute_op = 2'b01;
        #10;
        $display("%0t\tSUB\t%d\t%d\t%02b\t%b\t%b\t%b\t%b", $time, data_in, reg_sel, compute_op, result, done, negative, div_by_zero);

        // Compute SUB with negative result (3 - 7 = -4)
        // Load A = 3
        op_code = 3'b100;
        reg_sel = 2'b00;
        data_in = 4'd3; #10;

        // Load B = 7
        reg_sel = 2'b01;
        data_in = 4'd7; #10;

        // Now SUB (3 - 7 = -4)
        op_code = 3'b101;
        compute_op = 2'b01; #10;
        $display("%0t\tSUB2\t%d\t%d\t%02b\t%b\t%b\t%b\t%b", $time, data_in, reg_sel, compute_op, result, done, negative, div_by_zero);

        // MUL
        compute_op = 2'b10; #10;
        $display("%0t\tMUL\t%d\t%d\t%02b\t%b\t%b\t%b\t%b", $time, data_in, reg_sel, compute_op, result, done, negative, div_by_zero);

        // DIV
        compute_op = 2'b11; #10;
        $display("%0t\tDIV\t%d\t%d\t%02b\t%b\t%b\t%b\t%b", $time, data_in, reg_sel, compute_op, result, done, negative, div_by_zero);

        // DIV by zero test: load B = 0
        op_code = 3'b100;
        reg_sel = 2'b01;
        data_in = 4'd0; #10;

        op_code = 3'b101;
        compute_op = 2'b11; #10;
        $display("%0t\tDIV0\t%d\t%d\t%02b\t%b\t%b\t%b\t%b", $time, data_in, reg_sel, compute_op, result, done, negative, div_by_zero);

        $finish;
    end
endmodule

